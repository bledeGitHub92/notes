# 使用中间件
Express 是一个自身功能极简，完全是由路由和中间件构成一个的 web 开发框架：从本质上来说，一个 Express 应用就是在调用各种中间件。

**中间件（middleware）** 是一个函数，可以访问（**req, res, next**）。
> req：请求对象（request object）  
  res：响应对象（response object）  
  next： web 应用中处于请求-响应循环流程中的中间件

中间件的功能包括：
- 执行任何代码
- 修改请求和响应对象
- 终结请求-响应循环 -> 调用响应方法：res.end()、res.send()...
- 调用堆栈中的下一个中间件 -> 调用 next()

如果当前中间件没有终结请求-响应循环，则必须调用 next() 方法将控制权交给下一个中间件，否则请求就会挂起。

Express 应用可使用如下几种中间件：
- 应用级中间件
- 路由级中间件
- 错误处理中间件
- 内置中间件
- 第三方中间件

使用可选择挂载路径，可在应用级别或路由级别装载中间件。另外，可以同时装载一系列中间件函数，从而在一个挂载点上创建一个子中间件栈。
## 应用级中间件
应用级中间件绑定到 **app 对象** 使用 app.use() 和 app.METHOD() 。

> METHOD 是需要处理的请求方法，例如 GET，PUT，POST 等等，全部小写。

    var express require('express');
    var app = express();
    // 没有挂载路径的中间件，应用的每个请求都会执行该中间件
    app.use((req, res, next) => {
        console.log('Time', Date.now());
        next();
    });
    // 挂载至 /user/:id 的中间件，任何指向 /user/:id 的请求都会执行它
    app.use('/user/:id', (req, res, next) => {
        console.log('Request Type:', res.method);
        next();
    });
    // 路由句柄函数（中间系统），处理指向 /user/:id 的 GET 请求
    app.get('/user/:id', (req, res, next) => {
        res.send('USER');
    });
下面这个例子展示了在一个挂载点装载一组中间件。

    // 一个中间件，对任何指向 /user/:id 的 HTTP 请求打印相关信息
    app.use('/user/:id',
        (req, res, next) => {
            console.log('Request URL:', req.originalURL);
            next();
        },
        (req, res, next) => {
            console.log('Request Type:', req.method);
            next();
        }
    );